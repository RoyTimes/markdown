# How did I creat a blog System(3)

之前的两篇，[第一篇](http://ziorix.com/#/posts/web/3)谈到了设计的基础，[第二篇](http://ziorix.com/#/posts/web/4)讲了一下目前设计的样子，[这一篇](http://ziorix.com/#/posts/web/5)开始终于讲一讲技术的细节，设计的过程等等了。想要看完整的带排版的话请看原文。前段时间写的比较密集，这几天休息休息，出去游个泳健个身啥的。总之过几天再开始维护。各位要是有Github账号，给个Star啥的我会很感谢的。>> [链接](http://github.com/RoyTimes/materialize_blog) 

## 开端
1. Hexo的配置太麻烦了，需要读很多文档，现在还是复杂的按照模板生成的简直不想弄。原来博客的UI并不能说不好看然而还是别人的感觉太重了。自己写自己的要需要ejs去写，而且e的部分还需要读原版hexo-core的文档。不想搞，心累。
2. 比较执迷React.js技术。那天逛了一下国外的社区，看到了强烈推荐的一套UI(也就是现在博客用到的UI) -> [material-ui](https://material-ui.com) 我也是很少见的在Footer上注释了一下这个东西，人家写的好。之后我尝试用UI去写，很麻烦，配置上比较复杂，加上最开始并不是特别懂React的Children的构架，写的东西自己都看不下去。争得对方团队同意后，于是干脆直接用了人家官网的源码，到了现在基本成品的时候只保留了最原始的Master，主页，右边栏这三个源文件，其他的全部重写了。

## 开始的第一步
1. 第一个问题就是到底一个博客系统需要什么东西。很简单，一个主页，一个分类的导航，帖子，再加一些再帖子之外的Pages(就像自我介绍啊, 一些小的应用程序一类的。)。现在流行的Tag Cloud, RSS乱七八糟的都去掉把。以后心情好再加。毕竟从头开始的话就要“完全从头开始” Anything. 完全。所以就像所有的React Router构建的单页应用一样。第一件事情就是考虑路由表的URL处理。最后的解决方案大体概述就是`#/posts/`作为帖子根目录，直接访问的话会Redirect到`#/posts/recent`这个地方生成文章列表。之后就是分类`#posts/{category}/`这样。同样直接访问的话会Redirect到`#/posts/{category}/recent`这样的。之后帖子就直接`#/posts/{category}/1`这样顺序排下去了。也方便转载。之前弃用Hexo的一个原因就是帖子中会生成中文，不但不利于SEO还不是很方便直接传播。。大家总是说“诶。。你给的地址404啊”我只能无奈地说。“你把中文的部分也复制过去”。。对方只能一脸鄙夷地“好吧233”

2. 关于帖子的整理问题，很容易就会想到Markdown，之后每一个帖子给一个文件夹。。之后建立一个组件专门用来加载Post. 之后考虑到因为React的特点会把Post全编译进去23333. 所以会造成JS生成的巨大，在可意料的情况下很有可能中文也会出问题。所以综合考虑最靠谱的方法是把文档分离出来动态加载。之后文档的目录很自然的我想到打包成一个JSON文件包含一切信息。

3. 想到这里就可以着手写路由的代码了。遇到的第一个问题就是。。两个东西的区别之前看文档啊啥的都被我忽略了。那就是React Class和React component. 因为两者基本上一致，在`<Route component={}>`的参数里就除了问题，我到底传入个什么玩意才可以。比如说负责处理那个部分的组件名字叫做Home.我到底是传入`{Home}`还是`{<Home/>}`. 嗯，这个部分还好，试一下看编译不过就知道是`{Home}`了。。那么问题就好了。`<Route path=“posts/web” component={?}>` 这该咋办。正常来讲应该是`<PostList />`组件负责渲染，之后需要告诉组件你要渲染那一个部分的帖子。于是我就去了Github Issue竟然看到了有人也想到了同样的问题，之后看到了官方的回复我整个人都不好了。主作者说: “我不喜欢这种传入参数的东西，所以老子没考虑”。。我内心: “^&*%^&$%&$”。后来仔细研究了一下(大概通过命令行输出各种参数的文件格式)之后发现那个部分的参数接受的是一个React component而不是一个class。我心里: “FB不是说好这就是一个component based的库吗。。这TM竟然和Class还有区别233” 现在我理解起来component是类似于Factory。。用于生成class... 具体我也不是很懂，该仔细读读文档把。于是这部分我最终的代码是这样的: `<Route path=“recent” component={()=>(<PostList range=“web”/>)}` 算是成功传入了参数，用了这个挺甜的ES6的语法糖。

4. 关于动态阅读数组生成路由代码。之前完成的只是一个分开路由的部分，这个部分才是最困难的，想起来还是比较Straight Forward的。。把数组遍历一下，之后按照不同的元素规则打印不同的代码之后插入到大路路由里就可以了把。首先第一个问题是: React的JSX所有插入的HTML代码必须是Bound在一起的。一般情况下返回多个直接`<div>`包裹一下。然而现在的情况是，`<Route>`不可以掺入奇怪的东西。之后就是在HTML里掺入JS的方法。毕竟不是模板引擎所以只支持中间插入`{for(){}}`一类生成__单个__元素。最后还是用了ES6的数组语法`.map`这里其实也可以用lodash的语法。然而懒，不想看Doc. 

这篇先写这么多。分个Pi










